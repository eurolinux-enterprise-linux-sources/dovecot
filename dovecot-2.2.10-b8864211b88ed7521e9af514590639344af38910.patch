From b8864211b88ed7521e9af514590639344af38910 Mon Sep 17 00:00:00 2001
From: Timo Sirainen <tss@iki.fi>
Date: Wed, 28 May 2014 18:17:52 +0300
Subject: [PATCH] lib-index: Fixed somewhat random assert-crashes during
 extension resizes.

---
 src/lib-index/mail-index-transaction-export.c | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/src/lib-index/mail-index-transaction-export.c b/src/lib-index/mail-index-transaction-export.c
index a698674..2ad8565 100644
--- a/src/lib-index/mail-index-transaction-export.c
+++ b/src/lib-index/mail-index-transaction-export.c
@@ -114,10 +114,10 @@ static void log_append_ext_intro(struct mail_index_export_context *ctx,
 		/* we're resizing the extension. use the resize struct. */
 		intro = &resizes[ext_id];
 
-		i_assert(intro->ext_id == idx || idx == (uint32_t)-1);
-		if (idx != (uint32_t)-1)
+		if (idx != (uint32_t)-1) {
+			intro->ext_id = idx;
 			intro->name_size = 0;
-		else {
+		} else {
 			intro->ext_id = (uint32_t)-1;
 			intro->name_size = strlen(rext->name);
 		}
